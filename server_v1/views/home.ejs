<!DOCTYPE html>
<html>

<head>
    <title>gRPC Control Panel</title>
    <meta http-equiv="refresh"> <!-- content="15" This reload the page every 15 seconds -->

    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="../style/style.css">
    </link>
</head>

<body>
    <div class="gRPC Control Panel">
        <div id="topbar" class="d-flex align-items-end flex-column">
            <h5>
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                    viewBox="0 0 448 512"><!--Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
                    <path
                        d="M304 128a80 80 0 1 0 -160 0 80 80 0 1 0 160 0zM96 128a128 128 0 1 1 256 0A128 128 0 1 1 96 128zM49.3 464l349.5 0c-8.9-63.3-63.3-112-129-112l-91.4 0c-65.7 0-120.1 48.7-129 112zM0 482.3C0 383.8 79.8 304 178.3 304l91.4 0C368.2 304 448 383.8 448 482.3c0 16.4-13.3 29.7-29.7 29.7L29.7 512C13.3 512 0 498.7 0 482.3z" />
                </svg>
                <%= username%>
            </h5>
            <form action="logout">

                <button class="btn-danger">Logout <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                        viewBox="0 0 512 512"><!--Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
                        <path
                            d="M502.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-128-128c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L402.7 224 192 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l210.7 0-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l128-128zM160 96c17.7 0 32-14.3 32-32s-14.3-32-32-32L96 32C43 32 0 75 0 128L0 384c0 53 43 96 96 96l64 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0c-17.7 0-32-14.3-32-32l0-256c0-17.7 14.3-32 32-32l64 0z" />
                    </svg></button>
            </form>
        </div>
        <div id="title">
            <h3 class="d-flex justify-content-center">CONTROL PANEL</h3>
        </div>
        <div class="container mt-5 mb-4">
            <div class="row">
                <div class="col-5 d-flex align-content-center justify-content-center">
                    <div class=" btn-group-vertical  border border-dark d-flex ">
                        <form action="/start-client" class="d-flex flex-column" method="POST">
                            <button id="1" type="submit" class="clients-btn  m-2 p-2" name="clientName"
                                value="rail_lights_cross1_client"><svg xmlns="http://www.w3.org/2000/svg" width="16"
                                    height="16"
                                    viewBox="0 0 384 512"><!--Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
                                    <path
                                        d="M96 0C78.3 0 64 14.3 64 32l0 96 64 0 0-96c0-17.7-14.3-32-32-32zM288 0c-17.7 0-32 14.3-32 32l0 96 64 0 0-96c0-17.7-14.3-32-32-32zM32 160c-17.7 0-32 14.3-32 32s14.3 32 32 32l0 32c0 77.4 55 142 128 156.8l0 67.2c0 17.7 14.3 32 32 32s32-14.3 32-32l0-67.2C297 398 352 333.4 352 256l0-32c17.7 0 32-14.3 32-32s-14.3-32-32-32L32 160z" />
                                </svg> Rail Light Cross 1</button>
                            <button type="submit" id="2" class="clients-btn m-2 p-2" name="clientName"
                                value="road_lights_client"><svg xmlns="http://www.w3.org/2000/svg" width="16"
                                    height="16"
                                    viewBox="0 0 384 512"><!--Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
                                    <path
                                        d="M96 0C78.3 0 64 14.3 64 32l0 96 64 0 0-96c0-17.7-14.3-32-32-32zM288 0c-17.7 0-32 14.3-32 32l0 96 64 0 0-96c0-17.7-14.3-32-32-32zM32 160c-17.7 0-32 14.3-32 32s14.3 32 32 32l0 32c0 77.4 55 142 128 156.8l0 67.2c0 17.7 14.3 32 32 32s32-14.3 32-32l0-67.2C297 398 352 333.4 352 256l0-32c17.7 0 32-14.3 32-32s-14.3-32-32-32L32 160z" />
                                </svg> Road Lights Street 3 </button>
                            <button id="3" class="clients-btn m-2 p-2" name="clientName"
                                value="train_sensor_client"><svg xmlns="http://www.w3.org/2000/svg" width="16"
                                    height="16"
                                    viewBox="0 0 384 512"><!--Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
                                    <path
                                        d="M96 0C78.3 0 64 14.3 64 32l0 96 64 0 0-96c0-17.7-14.3-32-32-32zM288 0c-17.7 0-32 14.3-32 32l0 96 64 0 0-96c0-17.7-14.3-32-32-32zM32 160c-17.7 0-32 14.3-32 32s14.3 32 32 32l0 32c0 77.4 55 142 128 156.8l0 67.2c0 17.7 14.3 32 32 32s32-14.3 32-32l0-67.2C297 398 352 333.4 352 256l0-32c17.7 0 32-14.3 32-32s-14.3-32-32-32L32 160z" />
                                </svg> Train Sensor </button>
                            <button id="4" class="clients-btn m-2 p-2" name="clientName"
                                value="train_barrier_client"><svg xmlns="http://www.w3.org/2000/svg" width="16"
                                    height="16"
                                    viewBox="0 0 384 512"><!--Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
                                    <path
                                        d="M96 0C78.3 0 64 14.3 64 32l0 96 64 0 0-96c0-17.7-14.3-32-32-32zM288 0c-17.7 0-32 14.3-32 32l0 96 64 0 0-96c0-17.7-14.3-32-32-32zM32 160c-17.7 0-32 14.3-32 32s14.3 32 32 32l0 32c0 77.4 55 142 128 156.8l0 67.2c0 17.7 14.3 32 32 32s32-14.3 32-32l0-67.2C297 398 352 333.4 352 256l0-32c17.7 0 32-14.3 32-32s-14.3-32-32-32L32 160z" />
                                </svg> Train Barrier </button>

                        </form>
                    </div>
                </div>
                <div class="col-7 border border-dark p-1">
                    <pre id="logs-box">
                        <%=logs%>
                        </pre>
                </div>
            </div>
            <form action="/viewLogs" class="d-flex justify-content-end" method="get" target="_blank">
                <button class="m-2 p-2">
                    </svg> Open Logs File</button>
            </form>
        </div>
    </div>
    </div>

    <!-- AJAX to get the logs updated to be displayed in the box, calling it every interval of 15 seconds -->
    <script>
        function updateLogs() {
            fetch('/getLogs')
                .then(res => res.text())
                .then(data => {
                    document.getElementById('logs-box').textContent = data;

                    // Scroll the last log entry into view
                    const lastLog = logsBox.lastElementChild;
                    if (lastLog) {
                        lastLog.scrollIntoView({ behavior: 'smooth', block: 'end' });
                    }
                })

                .catch(err => console.error("Failed to load logs:", err));
        }

        setInterval(updateLogs, 15000);
    </script>
    <script>
        document.querySelectorAll("button[id]").forEach(btn => {
            btn.onclick = () => {
                btn.style.background = "green";
            };
        });
    </script>
</body>

</html>